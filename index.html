<!-- Add this new CSS style -->
<style>
  .selected-employee {
    border: 3px solid #006c4b !important;
    background: #e0f7e9 !important;
  }

  .selection-check {
    position: absolute;
    top: 10px;
    left: 10px;
    color: #006c4b;
    font-size: 1.5rem;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  [dir="rtl"] .selection-check {
    left: auto;
    right: 10px;
  }

  .selected-employee .selection-check {
    opacity: 1;
  }

  .generate-button {
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--primary-color);
    color: white;
    padding: 1rem 2rem;
    border-radius: 30px;
    cursor: pointer;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    display: none;
    z-index: 100;
    border: none;
    font-size: 1.1rem;
  }

  .generate-button:hover {
    background: #004d33;
    transform: translateX(-50%) translateY(-2px);
  }
</style>

<!-- Add this button before closing body tag -->
<button class="generate-button" id="generateButton" data-translate-key="generate_message">إنشاء رسالة شكر جماعية</button>

<!-- Update the JavaScript section -->
<script>
  let selectedEmployees = [];

  function showEmployeeGrid() {
    const container = document.getElementById('cardContainer');
    container.innerHTML = '';
    selectedEmployees = [];
    document.getElementById('generateButton').style.display = 'none';
    
    document.querySelector('h1').textContent = translations.select_employee[currentLang];
    
    const grid = document.createElement('div');
    grid.className = 'employee-grid';
    
    employees.forEach(employee => {
      const card = document.createElement('div');
      card.className = 'employee-card';
      card.innerHTML = `
        <div class="employee-info">
          <i class="fas fa-user-tie"></i>
          <h3>${employee.name[currentLang]}</h3>
          <i class="fas fa-check-circle selection-check"></i>
        </div>
      `;
      
      card.addEventListener('click', () => toggleEmployeeSelection(employee, card));
      grid.appendChild(card);
    });
    
    container.appendChild(grid);
  }

  function toggleEmployeeSelection(employee, card) {
    const index = selectedEmployees.findIndex(e => e.id === employee.id);
    if (index === -1) {
      selectedEmployees.push(employee);
      card.classList.add('selected-employee');
    } else {
      selectedEmployees.splice(index, 1);
      card.classList.remove('selected-employee');
    }
    
    document.getElementById('generateButton').style.display = 
      selectedEmployees.length > 0 ? 'block' : 'none';
  }

  function generateCombinedMessage() {
    const container = document.getElementById('cardContainer');
    container.innerHTML = '';
    
    const backButton = document.createElement('button');
    backButton.className = 'back-button';
    backButton.textContent = currentLang === 'ar' ? 'العودة إلى القائمة' : 'Back to List';
    backButton.onclick = showEmployeeGrid;
    container.appendChild(backButton);
    
    const card = document.createElement('div');
    card.className = 'card';
    
    const combinedContent = document.createElement('div');
    combinedContent.innerHTML = `
      <div class="employee-info">
        <i class="fas fa-users"></i>
        <h3>${currentLang === 'ar' ? 
          `تم اختيار ${selectedEmployees.length} موظفين` : 
          `${selectedEmployees.length} Employees Selected`}</h3>
      </div>
    `;

    const messageList = document.createElement('div');
    messageList.style.marginTop = '1.5rem';
    
    selectedEmployees.forEach((employee, index) => {
      const messageDiv = document.createElement('div');
      messageDiv.innerHTML = `
        <p><strong>${index + 1}. ${employee.name[currentLang]}:</strong> 
        ${employee.message[currentLang]}</p>
      `;
      messageList.appendChild(messageDiv);
    });

    const buttons = createShareButtons(
      selectedEmployees.map(e => e.message[currentLang]).join('\n\n')
    );

    card.appendChild(combinedContent);
    card.appendChild(messageList);
    card.appendChild(buttons);
    container.appendChild(card);
    
    document.querySelector('h1').textContent = currentLang === 'ar' ? 
      'رسالة شكر جماعية' : 'Combined Appreciation Message';
  }

  function createShareButtons(fullText) {
    const buttons = document.createElement('div');
    buttons.className = 'share-buttons';

    const socialPlatforms = [
      {icon: 'fab fa-x-twitter', base: 'https://twitter.com/intent/tweet?text='},
      {icon: 'fab fa-whatsapp', base: 'https://wa.me/?text='},
      {icon: 'fab fa-facebook-f', base: 'https://www.facebook.com/sharer/sharer.php?u='},
      {icon: 'fab fa-instagram', base: 'https://www.instagram.com/'}
    ];

    socialPlatforms.forEach(platform => {
      const link = document.createElement('a');
      link.className = 'share-btn';
      link.innerHTML = `<i class="${platform.icon}"></i>`;
      link.target = '_blank';
      const shareText = currentLang === 'ar' ? 
        `${fullText} #الحج_والعمرة` : 
        `${fullText} #Hajj_Umrah`;
      link.href = platform.base + encodeURIComponent(
        platform.icon.includes('facebook') ? `${shareText} ${window.location.href}` : shareText
      );
      buttons.appendChild(link);
    });

    return buttons;
  }

  // Update translations
  translations.generate_message = {
    ar: "إنشاء رسالة شكر جماعية",
    en: "Generate Combined Message"
  };

  // Add event listener for the generate button
  document.getElementById('generateButton').addEventListener('click', generateCombinedMessage);

  // Update the selectLanguage function
  function selectLanguage(lang) {
    // ... existing code ...
    document.querySelectorAll('[data-translate-key]').forEach(element => {
      const key = element.dataset.translateKey;
      element.textContent = translations[key][lang];
    });
    // Update generate button text
    document.getElementById('generateButton').textContent = translations.generate_message[lang];
  }
</script>
